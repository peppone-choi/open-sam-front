"use strict";(self.webpackChunkopen_sam_front=self.webpackChunkopen_sam_front||[]).push([[641,827],{"./src/components/logh/GroundCombatHUD.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{CompletedBattle:()=>CompletedBattle,Default:()=>Default,LandingPhase:()=>LandingPhase,__namedExportsOrder:()=>__namedExportsOrder,default:()=>GroundCombatHUD_stories});var react=__webpack_require__("./node_modules/react/index.js"),logh=__webpack_require__("./src/lib/api/logh.ts");function GroundCombatHUD({battleId,sessionId}){const[combatState,setCombatState]=(0,react.useState)(null),[loading,setLoading]=(0,react.useState)(!0),[error,setError]=(0,react.useState)(null),[selectedTab,setSelectedTab]=(0,react.useState)("occupation");(0,react.useEffect)(()=>{fetchCombatState();const interval=setInterval(fetchCombatState,5e3);return()=>clearInterval(interval)},[battleId,sessionId]);const fetchCombatState=async()=>{try{setLoading(!0);const response=await logh.loghApi.getGroundCombatState(battleId,sessionId);response.success&&(setCombatState(response.data),setError(null))}catch(err){setError(err.message||"Failed to fetch ground combat state")}finally{setLoading(!1)}},getFactionColor=faction=>{switch(faction){case"empire":return"text-red-400";case"alliance":return"text-blue-400";case"rebel":return"text-green-400";default:return"text-gray-400"}},getStatusColor=status=>{switch(status){case"secured":return"bg-green-500/20 border-green-500";case"contested":return"bg-yellow-500/20 border-yellow-500";case"under_siege":return"bg-red-500/20 border-red-500";default:return"bg-gray-500/20 border-gray-500"}},getSupplyStatusColor=status=>{switch(status){case"available":return"text-green-400";case"deployed":return"text-yellow-400";case"exhausted":return"text-red-400";default:return"text-gray-400"}};return loading&&!combatState?React.createElement("div",{className:"fixed top-4 right-4 bg-black/90 border border-cyan-500 rounded-lg p-4 min-w-[400px]"},React.createElement("div",{className:"text-cyan-400 animate-pulse"},"Loading ground combat data...")):error?React.createElement("div",{className:"fixed top-4 right-4 bg-black/90 border border-red-500 rounded-lg p-4 min-w-[400px]"},React.createElement("div",{className:"text-red-400"},"Error: ",error)):combatState?React.createElement("div",{className:"fixed top-4 right-4 bg-black/90 border border-cyan-500 rounded-lg p-4 min-w-[500px] max-w-[600px] max-h-[80vh] overflow-hidden flex flex-col backdrop-blur"},React.createElement("div",{className:"mb-4 pb-3 border-b border-cyan-500/30"},React.createElement("h2",{className:"text-cyan-400 font-bold text-lg mb-1"},"Ground Combat HUD"),React.createElement("div",{className:"flex justify-between text-sm"},React.createElement("span",{className:"text-gray-400"},"Battle: ",combatState.battleId.substring(0,8),"..."),React.createElement("span",{className:"text-gray-400"},"Grid: (",combatState.gridCoordinates.x,", ",combatState.gridCoordinates.y,")")),React.createElement("div",{className:"mt-2"},React.createElement("span",{className:"text-xs text-gray-500"},"Phase: "),React.createElement("span",{className:"text-yellow-400 uppercase font-bold text-sm"},combatState.combatPhase))),React.createElement("div",{className:"flex gap-2 mb-4"},React.createElement("button",{onClick:()=>setSelectedTab("occupation"),className:"px-4 py-2 rounded text-sm font-medium transition-colors "+("occupation"===selectedTab?"bg-cyan-500 text-black":"bg-cyan-500/20 text-cyan-400 hover:bg-cyan-500/30")},"Occupation (",combatState.occupationStatus.length,")"),React.createElement("button",{onClick:()=>setSelectedTab("supplies"),className:"px-4 py-2 rounded text-sm font-medium transition-colors "+("supplies"===selectedTab?"bg-cyan-500 text-black":"bg-cyan-500/20 text-cyan-400 hover:bg-cyan-500/30")},"Supplies (",combatState.supplyBatches.filter(b=>"available"===b.status).length,")"),React.createElement("button",{onClick:()=>setSelectedTab("warehouse"),className:"px-4 py-2 rounded text-sm font-medium transition-colors "+("warehouse"===selectedTab?"bg-cyan-500 text-black":"bg-cyan-500/20 text-cyan-400 hover:bg-cyan-500/30")},"Warehouse (",combatState.warehouseStocks.length,")")),React.createElement("div",{className:"flex-1 overflow-y-auto space-y-3 pr-2"},"occupation"===selectedTab&&React.createElement("div",{className:"space-y-3"},combatState.occupationStatus.map(occupation=>React.createElement("div",{key:occupation.planetId,className:`border rounded-lg p-3 ${getStatusColor(occupation.status)}`},React.createElement("div",{className:"flex justify-between items-start mb-2"},React.createElement("div",null,React.createElement("h3",{className:"font-bold text-white"},occupation.planetName),React.createElement("span",{className:`text-xs font-medium ${getFactionColor(occupation.controllingFaction)}`},occupation.controllingFaction.toUpperCase())),React.createElement("span",{className:"text-xs text-gray-400 uppercase"},occupation.status)),React.createElement("div",{className:"mb-2"},React.createElement("div",{className:"flex justify-between text-xs text-gray-400 mb-1"},React.createElement("span",null,"Occupation Progress"),React.createElement("span",null,occupation.occupationProgress,"%")),React.createElement("div",{className:"w-full bg-gray-700 rounded-full h-2"},React.createElement("div",{className:"bg-cyan-500 h-2 rounded-full transition-all duration-500",style:{width:`${occupation.occupationProgress}%`}}))),React.createElement("div",{className:"grid grid-cols-2 gap-2 text-xs"},React.createElement("div",null,React.createElement("span",{className:"text-gray-400"},"Defense: "),React.createElement("span",{className:"text-white font-medium"},occupation.defenseStrength)),React.createElement("div",null,React.createElement("span",{className:"text-gray-400"},"Garrison: "),React.createElement("span",{className:"text-white font-medium"},occupation.garrisonUnits)),React.createElement("div",{className:"col-span-2"},React.createElement("span",{className:"text-gray-400"},"Supply Lines: "),React.createElement("span",{className:"text-white font-medium"},occupation.supplyLines.length||"None")))))),"supplies"===selectedTab&&React.createElement("div",{className:"space-y-3"},combatState.supplyBatches.map(batch=>React.createElement("div",{key:batch.batchId,className:"border border-cyan-500/30 rounded-lg p-3 bg-cyan-500/5"},React.createElement("div",{className:"flex justify-between items-start mb-2"},React.createElement("div",null,React.createElement("h3",{className:"font-bold text-white capitalize"},batch.type),React.createElement("span",{className:"text-xs text-gray-400"},batch.location)),React.createElement("span",{className:`text-xs font-medium uppercase ${getSupplyStatusColor(batch.status)}`},batch.status)),React.createElement("div",{className:"space-y-1 text-sm"},React.createElement("div",{className:"flex justify-between"},React.createElement("span",{className:"text-gray-400"},"Quantity:"),React.createElement("span",{className:"text-white font-medium"},batch.quantity)),React.createElement("div",{className:"flex justify-between"},React.createElement("span",{className:"text-gray-400"},"Assigned Units:"),React.createElement("span",{className:"text-white font-medium"},batch.assignedUnits.length)))))),"warehouse"===selectedTab&&React.createElement("div",{className:"space-y-3"},combatState.warehouseStocks.map(warehouse=>{const totalStock=Object.values(warehouse.inventory).reduce((sum,qty)=>sum+qty,0),usagePercent=totalStock/warehouse.capacity*100;return React.createElement("div",{key:warehouse.warehouseId,className:"border border-cyan-500/30 rounded-lg p-3 bg-cyan-500/5"},React.createElement("div",{className:"flex justify-between items-start mb-3"},React.createElement("div",null,React.createElement("h3",{className:"font-bold text-white"},"Warehouse"),React.createElement("span",{className:"text-xs text-gray-400"},"Planet: ",warehouse.planetId)),React.createElement("span",{className:`text-xs font-medium ${getFactionColor(warehouse.faction)}`},warehouse.faction.toUpperCase())),React.createElement("div",{className:"mb-3"},React.createElement("div",{className:"flex justify-between text-xs text-gray-400 mb-1"},React.createElement("span",null,"Capacity"),React.createElement("span",null,totalStock," / ",warehouse.capacity," (",usagePercent.toFixed(0),"%)")),React.createElement("div",{className:"w-full bg-gray-700 rounded-full h-2"},React.createElement("div",{className:"h-2 rounded-full transition-all duration-500 "+(usagePercent>90?"bg-red-500":usagePercent>70?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(usagePercent,100)}%`}}))),React.createElement("div",{className:"grid grid-cols-2 gap-2 text-xs"},Object.entries(warehouse.inventory).map(([item,qty])=>React.createElement("div",{key:item,className:"flex justify-between"},React.createElement("span",{className:"text-gray-400 capitalize"},item,":"),React.createElement("span",{className:"text-white font-medium"},qty)))),React.createElement("div",{className:"mt-2 text-xs text-gray-500"},"Updated: ",new Date(warehouse.lastUpdated).toLocaleTimeString()))}))),React.createElement("div",{className:"mt-4 pt-3 border-t border-cyan-500/30 text-xs text-gray-500"},"Last update: ",new Date(combatState.lastUpdateAt).toLocaleTimeString())):null}try{GroundCombatHUD.displayName="GroundCombatHUD",GroundCombatHUD.__docgenInfo={description:"",displayName:"GroundCombatHUD",props:{battleId:{defaultValue:null,description:"",name:"battleId",required:!0,type:{name:"string"}},sessionId:{defaultValue:null,description:"",name:"sessionId",required:!1,type:{name:"string | undefined"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/logh/GroundCombatHUD.tsx#GroundCombatHUD"]={docgenInfo:GroundCombatHUD.__docgenInfo,name:"GroundCombatHUD",path:"src/components/logh/GroundCombatHUD.tsx#GroundCombatHUD"})}catch(__react_docgen_typescript_loader_error){}const GroundCombatHUD_stories={title:"LOGH/GroundCombatHUD",component:GroundCombatHUD,parameters:{layout:"fullscreen",backgrounds:{default:"dark",values:[{name:"dark",value:"#000000"}]}},tags:["autodocs"]},Default={args:{battleId:"battle-ground-001",sessionId:"session-test"},parameters:{docs:{description:{story:"Ground Combat HUD showing occupation status, supply distribution, and warehouse inventory."}},msw:{handlers:[{method:"get",path:"/api/logh/ground-combat/:battleId",response:{success:!0,data:{battleId:"battle-ground-001",gridCoordinates:{x:15,y:23},combatPhase:"engagement",occupationStatus:[{planetId:"planet-001",planetName:"Phezzan",controllingFaction:"empire",occupationProgress:65,defenseStrength:75,garrisonUnits:1200,supplyLines:["supply-line-1","supply-line-2"],status:"contested"},{planetId:"planet-002",planetName:"Heinessen",controllingFaction:"alliance",occupationProgress:90,defenseStrength:95,garrisonUnits:3e3,supplyLines:["supply-line-3"],status:"secured"},{planetId:"planet-003",planetName:"Iserlohn",controllingFaction:"rebel",occupationProgress:30,defenseStrength:40,garrisonUnits:800,supplyLines:[],status:"under_siege"}],supplyBatches:[{batchId:"batch-001",type:"fuel",quantity:1500,location:"landing-zone-empire",assignedUnits:["unit-1","unit-2"],status:"available"},{batchId:"batch-002",type:"ammunition",quantity:800,location:"forward-base-alpha",assignedUnits:["unit-3"],status:"deployed"},{batchId:"batch-003",type:"rations",quantity:0,location:"supply-depot-1",assignedUnits:[],status:"exhausted"},{batchId:"batch-004",type:"medical",quantity:400,location:"landing-zone-alliance",assignedUnits:[],status:"available"}],warehouseStocks:[{warehouseId:"warehouse-001",planetId:"planet-001",faction:"empire",inventory:{fuel:450,ammunition:300,rations:500,medical:150,equipment:200},capacity:2e3,lastUpdated:(new Date).toISOString()},{warehouseId:"warehouse-002",planetId:"planet-002",faction:"alliance",inventory:{fuel:800,ammunition:600,rations:300,medical:200,equipment:100},capacity:2e3,lastUpdated:(new Date).toISOString()}],lastUpdateAt:(new Date).toISOString()},compliance:[{manualRef:"gin7manual.txt:P.40-P.51",status:"✅",note:"Ground combat state retrieved successfully"}]}}]}}},LandingPhase={args:{battleId:"battle-ground-002",sessionId:"session-test"},parameters:{docs:{description:{story:"Ground Combat HUD during the landing phase - initial deployment."}},msw:{handlers:[{method:"get",path:"/api/logh/ground-combat/:battleId",response:{success:!0,data:{battleId:"battle-ground-002",gridCoordinates:{x:10,y:15},combatPhase:"landing",occupationStatus:[{planetId:"planet-004",planetName:"Odin",controllingFaction:"neutral",occupationProgress:0,defenseStrength:100,garrisonUnits:0,supplyLines:[],status:"contested"}],supplyBatches:[{batchId:"batch-005",type:"fuel",quantity:2e3,location:"orbital-drop-zone",assignedUnits:[],status:"available"}],warehouseStocks:[{warehouseId:"warehouse-003",planetId:"planet-004",faction:"neutral",inventory:{fuel:100,ammunition:50,rations:200,medical:75,equipment:25},capacity:2e3,lastUpdated:(new Date).toISOString()}],lastUpdateAt:(new Date).toISOString()}}}]}}},CompletedBattle={args:{battleId:"battle-ground-003",sessionId:"session-test"},parameters:{docs:{description:{story:"Ground Combat HUD showing a completed battle with full occupation."}},msw:{handlers:[{method:"get",path:"/api/logh/ground-combat/:battleId",response:{success:!0,data:{battleId:"battle-ground-003",gridCoordinates:{x:20,y:30},combatPhase:"completed",occupationStatus:[{planetId:"planet-005",planetName:"Vermillion",controllingFaction:"alliance",occupationProgress:100,defenseStrength:100,garrisonUnits:5e3,supplyLines:["supply-line-4","supply-line-5","supply-line-6"],status:"secured"}],supplyBatches:[{batchId:"batch-006",type:"fuel",quantity:500,location:"main-base",assignedUnits:["unit-5","unit-6","unit-7"],status:"deployed"}],warehouseStocks:[{warehouseId:"warehouse-004",planetId:"planet-005",faction:"alliance",inventory:{fuel:1800,ammunition:1500,rations:1200,medical:800,equipment:700},capacity:6e3,lastUpdated:(new Date).toISOString()}],lastUpdateAt:(new Date).toISOString()}}}]}}},__namedExportsOrder=["Default","LandingPhase","CompletedBattle"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"{\n  args: {\n    battleId: 'battle-ground-001',\n    sessionId: 'session-test'\n  },\n  parameters: {\n    docs: {\n      description: {\n        story: 'Ground Combat HUD showing occupation status, supply distribution, and warehouse inventory.'\n      }\n    },\n    msw: {\n      handlers: [{\n        method: 'get',\n        path: '/api/logh/ground-combat/:battleId',\n        response: {\n          success: true,\n          data: {\n            battleId: 'battle-ground-001',\n            gridCoordinates: {\n              x: 15,\n              y: 23\n            },\n            combatPhase: 'engagement',\n            occupationStatus: [{\n              planetId: 'planet-001',\n              planetName: 'Phezzan',\n              controllingFaction: 'empire',\n              occupationProgress: 65,\n              defenseStrength: 75,\n              garrisonUnits: 1200,\n              supplyLines: ['supply-line-1', 'supply-line-2'],\n              status: 'contested'\n            }, {\n              planetId: 'planet-002',\n              planetName: 'Heinessen',\n              controllingFaction: 'alliance',\n              occupationProgress: 90,\n              defenseStrength: 95,\n              garrisonUnits: 3000,\n              supplyLines: ['supply-line-3'],\n              status: 'secured'\n            }, {\n              planetId: 'planet-003',\n              planetName: 'Iserlohn',\n              controllingFaction: 'rebel',\n              occupationProgress: 30,\n              defenseStrength: 40,\n              garrisonUnits: 800,\n              supplyLines: [],\n              status: 'under_siege'\n            }],\n            supplyBatches: [{\n              batchId: 'batch-001',\n              type: 'fuel',\n              quantity: 1500,\n              location: 'landing-zone-empire',\n              assignedUnits: ['unit-1', 'unit-2'],\n              status: 'available'\n            }, {\n              batchId: 'batch-002',\n              type: 'ammunition',\n              quantity: 800,\n              location: 'forward-base-alpha',\n              assignedUnits: ['unit-3'],\n              status: 'deployed'\n            }, {\n              batchId: 'batch-003',\n              type: 'rations',\n              quantity: 0,\n              location: 'supply-depot-1',\n              assignedUnits: [],\n              status: 'exhausted'\n            }, {\n              batchId: 'batch-004',\n              type: 'medical',\n              quantity: 400,\n              location: 'landing-zone-alliance',\n              assignedUnits: [],\n              status: 'available'\n            }],\n            warehouseStocks: [{\n              warehouseId: 'warehouse-001',\n              planetId: 'planet-001',\n              faction: 'empire',\n              inventory: {\n                fuel: 450,\n                ammunition: 300,\n                rations: 500,\n                medical: 150,\n                equipment: 200\n              },\n              capacity: 2000,\n              lastUpdated: new Date().toISOString()\n            }, {\n              warehouseId: 'warehouse-002',\n              planetId: 'planet-002',\n              faction: 'alliance',\n              inventory: {\n                fuel: 800,\n                ammunition: 600,\n                rations: 300,\n                medical: 200,\n                equipment: 100\n              },\n              capacity: 2000,\n              lastUpdated: new Date().toISOString()\n            }],\n            lastUpdateAt: new Date().toISOString()\n          },\n          compliance: [{\n            manualRef: 'gin7manual.txt:P.40-P.51',\n            status: '✅',\n            note: 'Ground combat state retrieved successfully'\n          }]\n        }\n      }]\n    }\n  }\n}",...Default.parameters?.docs?.source}}},LandingPhase.parameters={...LandingPhase.parameters,docs:{...LandingPhase.parameters?.docs,source:{originalSource:"{\n  args: {\n    battleId: 'battle-ground-002',\n    sessionId: 'session-test'\n  },\n  parameters: {\n    docs: {\n      description: {\n        story: 'Ground Combat HUD during the landing phase - initial deployment.'\n      }\n    },\n    msw: {\n      handlers: [{\n        method: 'get',\n        path: '/api/logh/ground-combat/:battleId',\n        response: {\n          success: true,\n          data: {\n            battleId: 'battle-ground-002',\n            gridCoordinates: {\n              x: 10,\n              y: 15\n            },\n            combatPhase: 'landing',\n            occupationStatus: [{\n              planetId: 'planet-004',\n              planetName: 'Odin',\n              controllingFaction: 'neutral',\n              occupationProgress: 0,\n              defenseStrength: 100,\n              garrisonUnits: 0,\n              supplyLines: [],\n              status: 'contested'\n            }],\n            supplyBatches: [{\n              batchId: 'batch-005',\n              type: 'fuel',\n              quantity: 2000,\n              location: 'orbital-drop-zone',\n              assignedUnits: [],\n              status: 'available'\n            }],\n            warehouseStocks: [{\n              warehouseId: 'warehouse-003',\n              planetId: 'planet-004',\n              faction: 'neutral',\n              inventory: {\n                fuel: 100,\n                ammunition: 50,\n                rations: 200,\n                medical: 75,\n                equipment: 25\n              },\n              capacity: 2000,\n              lastUpdated: new Date().toISOString()\n            }],\n            lastUpdateAt: new Date().toISOString()\n          }\n        }\n      }]\n    }\n  }\n}",...LandingPhase.parameters?.docs?.source}}},CompletedBattle.parameters={...CompletedBattle.parameters,docs:{...CompletedBattle.parameters?.docs,source:{originalSource:"{\n  args: {\n    battleId: 'battle-ground-003',\n    sessionId: 'session-test'\n  },\n  parameters: {\n    docs: {\n      description: {\n        story: 'Ground Combat HUD showing a completed battle with full occupation.'\n      }\n    },\n    msw: {\n      handlers: [{\n        method: 'get',\n        path: '/api/logh/ground-combat/:battleId',\n        response: {\n          success: true,\n          data: {\n            battleId: 'battle-ground-003',\n            gridCoordinates: {\n              x: 20,\n              y: 30\n            },\n            combatPhase: 'completed',\n            occupationStatus: [{\n              planetId: 'planet-005',\n              planetName: 'Vermillion',\n              controllingFaction: 'alliance',\n              occupationProgress: 100,\n              defenseStrength: 100,\n              garrisonUnits: 5000,\n              supplyLines: ['supply-line-4', 'supply-line-5', 'supply-line-6'],\n              status: 'secured'\n            }],\n            supplyBatches: [{\n              batchId: 'batch-006',\n              type: 'fuel',\n              quantity: 500,\n              location: 'main-base',\n              assignedUnits: ['unit-5', 'unit-6', 'unit-7'],\n              status: 'deployed'\n            }],\n            warehouseStocks: [{\n              warehouseId: 'warehouse-004',\n              planetId: 'planet-005',\n              faction: 'alliance',\n              inventory: {\n                fuel: 1800,\n                ammunition: 1500,\n                rations: 1200,\n                medical: 800,\n                equipment: 700\n              },\n              capacity: 6000,\n              lastUpdated: new Date().toISOString()\n            }],\n            lastUpdateAt: new Date().toISOString()\n          }\n        }\n      }]\n    }\n  }\n}",...CompletedBattle.parameters?.docs?.source}}}},"./src/lib/api/logh.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{loghApi:()=>loghApi});const API_BASE="/api/logh",fetchWithAuth=async(url,options={})=>{const headers={"Content-Type":"application/json",Authorization:"Bearer DEV-GALAXY-TOKEN",...options.headers},res=await fetch(url,{...options,headers});if(!res.ok){const error=await res.text().catch(()=>res.statusText);throw new Error(`API Error ${res.status}: ${error}`)}return res.json()},CMD_MAP={warp:"move_fleet",move:"move_fleet",attack:"issue_operation",supply:"issue_operation",personnel:"issue_operation",tactics:"issue_operation"},loghApi={getGalaxyViewport:async sessionId=>{const params=new URLSearchParams;sessionId&&params.set("sessionId",sessionId);const response=await fetch(`/api/gin7/state/strategy?${params.toString()}`);if(!response.ok)throw new Error("Failed to fetch galaxy viewport data");return response.json()},getGroundCombatState:async(battleId,sessionId)=>{const params=new URLSearchParams;sessionId&&params.set("sessionId",sessionId);const response=await fetch(`/api/logh/ground-combat/${battleId}?${params.toString()}`);if(!response.ok)throw new Error("Failed to fetch ground combat state");return response.json()},getOccupationStatus:async(battleId,sessionId)=>{const params=new URLSearchParams;sessionId&&params.set("sessionId",sessionId);const response=await fetch(`/api/logh/ground-combat/${battleId}/occupation?${params.toString()}`);if(!response.ok)throw new Error("Failed to fetch occupation status");return response.json()},getSupplyBatches:async(battleId,sessionId)=>{const params=new URLSearchParams;sessionId&&params.set("sessionId",sessionId);const response=await fetch(`/api/logh/ground-combat/${battleId}/supplies?${params.toString()}`);if(!response.ok)throw new Error("Failed to fetch supply batches");return response.json()},getWarehouseStocks:async(battleId,sessionId)=>{const params=new URLSearchParams;sessionId&&params.set("sessionId",sessionId);const response=await fetch(`/api/logh/ground-combat/${battleId}/warehouse?${params.toString()}`);if(!response.ok)throw new Error("Failed to fetch warehouse stocks");return response.json()},updateOccupation:async(battleId,planetId,updates,sessionId)=>{const response=await fetch(`/api/logh/ground-combat/${battleId}/occupation/${planetId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({...updates,sessionId})});if(!response.ok)throw new Error("Failed to update occupation status");return response.json()},consumeSupply:async(battleId,batchId,amount,sessionId)=>{const response=await fetch(`/api/logh/ground-combat/${battleId}/supplies/${batchId}/consume`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount,sessionId})});if(!response.ok)throw new Error("Failed to consume supply");return response.json()},getUserProfile:async()=>{const data=await fetchWithAuth(`${API_BASE}/galaxy/commanders?my_character=true`);if(data.data&&data.data.length>0){const cmd=data.data[0];return{id:cmd.no.toString(),name:cmd.name,rank:cmd.rank,faction:cmd.faction,pcp:cmd.commandPoints?.personal||0,mcp:cmd.commandPoints?.military||0,maxPcp:100,maxMcp:100,jobCards:[]}}throw new Error("No commander found")},executeCommand:async(cardId,command,target)=>{const backendCmd=CMD_MAP[command],data=await fetchWithAuth(`${API_BASE}/command/execute`,{method:"POST",body:JSON.stringify({command:backendCmd,params:{target,cardId}})});return{success:data.success,message:data.message||"Command executed",pcpCost:0,mcpCost:0}},getEconomyState:async(sessionId,characterId)=>{const params=new URLSearchParams({sessionId});characterId&&params.set("characterId",characterId);return(await fetchWithAuth(`${API_BASE}/galaxy/economy/state?${params}`)).data},getEconomyEvents:async(sessionId,characterId,limit=10)=>{const params=new URLSearchParams({sessionId,limit:limit.toString()});characterId&&params.set("characterId",characterId);return(await fetchWithAuth(`${API_BASE}/galaxy/economy/events?${params}`)).data},getChatMessages:async(sessionId,channelType,scopeId,limit=50)=>{const params=new URLSearchParams({sessionId,channelType,limit:limit.toString()});scopeId&&params.append("scopeId",scopeId);return(await fetchWithAuth(`${API_BASE}/galaxy/comm/messages?${params}`)).data||[]},sendChatMessage:async(sessionId,channelType,senderCharacterId,message,scopeId,metadata)=>(await fetchWithAuth(`${API_BASE}/galaxy/comm/messages`,{method:"POST",body:JSON.stringify({sessionId,channelType,scopeId,senderCharacterId,message,metadata})})).data,getHandshakes:async(sessionId,characterId)=>{const params=new URLSearchParams({sessionId,characterId});return(await fetchWithAuth(`${API_BASE}/galaxy/comm/handshakes?${params}`)).data||[]},requestHandshake:async(sessionId,requesterCharacterId,targetCharacterId)=>(await fetchWithAuth(`${API_BASE}/galaxy/comm/handshakes`,{method:"POST",body:JSON.stringify({sessionId,requesterCharacterId,targetCharacterId})})).data,respondHandshake:async(sessionId,handshakeId,responderCharacterId,action)=>(await fetchWithAuth(`${API_BASE}/galaxy/comm/handshakes/${handshakeId}/respond`,{method:"POST",body:JSON.stringify({sessionId,responderCharacterId,action})})).data,getAddressBook:async(sessionId,characterId)=>{const params=new URLSearchParams({sessionId,characterId});return(await fetchWithAuth(`${API_BASE}/galaxy/comm/address-book?${params}`)).data||[]},addAddressBookEntry:async(sessionId,ownerCharacterId,contactCharacterId,contactName)=>(await fetchWithAuth(`${API_BASE}/galaxy/comm/address-book`,{method:"POST",body:JSON.stringify({sessionId,ownerCharacterId,contactCharacterId,contactName})})).data,autoResolveBattle:async(battleId,resolverCharacterId)=>fetchWithAuth(`${API_BASE}/galaxy/tactical-battles/${battleId}/resolve`,{method:"POST",body:JSON.stringify({autoResolve:!0,resolverCharacterId})}),checkOfflineCommanders:async(battleId,sessionId)=>{const params=new URLSearchParams;sessionId&&params.set("sessionId",sessionId);return(await fetchWithAuth(`${API_BASE}/galaxy/tactical-battles/${battleId}/offline-check?${params}`)).data||{hasOfflineCommanders:!1,offlineCommanderIds:[]}},getMyFleet:async()=>{try{const res=await fetchWithAuth(`${API_BASE}/fleet/my`);if(res.data)return res.data}catch(e){}return{id:"mock-fleet-1",commanderName:"Yang Wen-li",faction:"alliance",gridX:10,gridY:10,size:5e3,status:"idle",formation:"standard",morale:95,supplies:8e3,ammo:7500,ships:Array.from({length:20}).map((_,i)=>({id:`ship-${i}`,name:`Hyperion-${i}`,type:0===i?"battleship":i<5?"cruiser":"destroyer",durability:100,maxDurability:100,crew:100,maxCrew:100,energy:100,maxEnergy:100,status:"active"}))}},updateFormation:async formationId=>{try{return await fetchWithAuth(`${API_BASE}/fleet/formation`,{method:"POST",body:JSON.stringify({formation:formationId})}),!0}catch(e){return console.warn("API failed, using mock success"),!0}},getBattleState:async battleId=>{try{const res=await fetchWithAuth(`${API_BASE}/galaxy/tactical-battles/${battleId}`);if(res.data)return res.data}catch(e){}return{id:battleId,turn:1,phase:"planning",fleets:[{fleetId:"f1",name:"13th Fleet",faction:"alliance",totalShips:5e3,formation:"standard",tacticalPosition:{x:2e3,y:5e3,heading:0}},{fleetId:"f2",name:"Imperial Fleet",faction:"empire",totalShips:8e3,formation:"spindle",tacticalPosition:{x:8e3,y:5e3,heading:180}}]}}}}}]);
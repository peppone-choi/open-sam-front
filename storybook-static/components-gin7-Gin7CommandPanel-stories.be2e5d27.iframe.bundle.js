/*! For license information please see components-gin7-Gin7CommandPanel-stories.be2e5d27.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkopen_sam_front=self.webpackChunkopen_sam_front||[]).push([[56],{"./node_modules/use-sync-external-store/cjs/use-sync-external-store-shim.production.js":(__unused_webpack_module,exports,__webpack_require__)=>{var React=__webpack_require__("./node_modules/react/index.js");var objectIs="function"==typeof Object.is?Object.is:function is(x,y){return x===y&&(0!==x||1/x==1/y)||x!=x&&y!=y},useState=React.useState,useEffect=React.useEffect,useLayoutEffect=React.useLayoutEffect,useDebugValue=React.useDebugValue;function checkIfSnapshotChanged(inst){var latestGetSnapshot=inst.getSnapshot;inst=inst.value;try{var nextValue=latestGetSnapshot();return!objectIs(inst,nextValue)}catch(error){return!0}}var shim="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function useSyncExternalStore$1(subscribe,getSnapshot){return getSnapshot()}:function useSyncExternalStore$2(subscribe,getSnapshot){var value=getSnapshot(),_useState=useState({inst:{value,getSnapshot}}),inst=_useState[0].inst,forceUpdate=_useState[1];return useLayoutEffect(function(){inst.value=value,inst.getSnapshot=getSnapshot,checkIfSnapshotChanged(inst)&&forceUpdate({inst})},[subscribe,value,getSnapshot]),useEffect(function(){return checkIfSnapshotChanged(inst)&&forceUpdate({inst}),subscribe(function(){checkIfSnapshotChanged(inst)&&forceUpdate({inst})})},[subscribe]),useDebugValue(value),value};exports.useSyncExternalStore=void 0!==React.useSyncExternalStore?React.useSyncExternalStore:shim},"./node_modules/use-sync-external-store/cjs/use-sync-external-store-shim/with-selector.production.js":(__unused_webpack_module,exports,__webpack_require__)=>{var React=__webpack_require__("./node_modules/react/index.js"),shim=__webpack_require__("./node_modules/use-sync-external-store/shim/index.js");var objectIs="function"==typeof Object.is?Object.is:function is(x,y){return x===y&&(0!==x||1/x==1/y)||x!=x&&y!=y},useSyncExternalStore=shim.useSyncExternalStore,useRef=React.useRef,useEffect=React.useEffect,useMemo=React.useMemo,useDebugValue=React.useDebugValue;exports.useSyncExternalStoreWithSelector=function(subscribe,getSnapshot,getServerSnapshot,selector,isEqual){var instRef=useRef(null);if(null===instRef.current){var inst={hasValue:!1,value:null};instRef.current=inst}else inst=instRef.current;instRef=useMemo(function(){function memoizedSelector(nextSnapshot){if(!hasMemo){if(hasMemo=!0,memoizedSnapshot=nextSnapshot,nextSnapshot=selector(nextSnapshot),void 0!==isEqual&&inst.hasValue){var currentSelection=inst.value;if(isEqual(currentSelection,nextSnapshot))return memoizedSelection=currentSelection}return memoizedSelection=nextSnapshot}if(currentSelection=memoizedSelection,objectIs(memoizedSnapshot,nextSnapshot))return currentSelection;var nextSelection=selector(nextSnapshot);return void 0!==isEqual&&isEqual(currentSelection,nextSelection)?(memoizedSnapshot=nextSnapshot,currentSelection):(memoizedSnapshot=nextSnapshot,memoizedSelection=nextSelection)}var memoizedSnapshot,memoizedSelection,hasMemo=!1,maybeGetServerSnapshot=void 0===getServerSnapshot?null:getServerSnapshot;return[function(){return memoizedSelector(getSnapshot())},null===maybeGetServerSnapshot?void 0:function(){return memoizedSelector(maybeGetServerSnapshot())}]},[getSnapshot,getServerSnapshot,selector,isEqual]);var value=useSyncExternalStore(subscribe,instRef[0],instRef[1]);return useEffect(function(){inst.hasValue=!0,inst.value=value},[value]),useDebugValue(value),value}},"./node_modules/use-sync-external-store/shim/index.js":(module,__unused_webpack_exports,__webpack_require__)=>{module.exports=__webpack_require__("./node_modules/use-sync-external-store/cjs/use-sync-external-store-shim.production.js")},"./node_modules/use-sync-external-store/shim/with-selector.js":(module,__unused_webpack_exports,__webpack_require__)=>{module.exports=__webpack_require__("./node_modules/use-sync-external-store/cjs/use-sync-external-store-shim/with-selector.production.js")},"./node_modules/zustand/esm/index.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{vt:()=>create});const createStoreImpl=createState=>{let state;const listeners=new Set,setState=(partial,replace)=>{const nextState="function"==typeof partial?partial(state):partial;if(!Object.is(nextState,state)){const previousState=state;state=(null!=replace?replace:"object"!=typeof nextState||null===nextState)?nextState:Object.assign({},state,nextState),listeners.forEach(listener=>listener(state,previousState))}},getState=()=>state,api={setState,getState,getInitialState:()=>initialState,subscribe:listener=>(listeners.add(listener),()=>listeners.delete(listener)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),listeners.clear()}},initialState=state=createState(setState,getState,api);return api},createStore=createState=>createState?createStoreImpl(createState):createStoreImpl;var react=__webpack_require__("./node_modules/react/index.js"),with_selector=__webpack_require__("./node_modules/use-sync-external-store/shim/with-selector.js");const{useDebugValue}=react,{useSyncExternalStoreWithSelector}=with_selector;let didWarnAboutEqualityFn=!1;const identity=arg=>arg;const createImpl=createState=>{"function"!=typeof createState&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const api="function"==typeof createState?createStore(createState):createState,useBoundStore=(selector,equalityFn)=>function useStore(api,selector=identity,equalityFn){equalityFn&&!didWarnAboutEqualityFn&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),didWarnAboutEqualityFn=!0);const slice=useSyncExternalStoreWithSelector(api.subscribe,api.getState,api.getServerState||api.getInitialState,selector,equalityFn);return useDebugValue(slice),slice}(api,selector,equalityFn);return Object.assign(useBoundStore,api),useBoundStore},create=createState=>createState?createImpl(createState):createImpl},"./src/components/gin7/Gin7CommandPanel.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>Gin7CommandPanel_stories});var react=__webpack_require__("./node_modules/react/index.js"),gin7Store=__webpack_require__("./src/stores/gin7Store.ts"),gameStore=__webpack_require__("./src/stores/gameStore.ts"),gin7=__webpack_require__("./src/lib/api/gin7.ts");var utils=__webpack_require__("./src/lib/utils.ts");const GROUP_LABELS={all:"전체",operation:"작전",tactical:"전술",command:"지휘",logistics:"병참",personnel:"인사",political:"정치",personal:"개인",intelligence:"정보"};function CPBar({label,value,max,tone}){const pct=Math.min(100,Math.round(value/Math.max(1,max)*100)),gradient="blue"===tone?"from-cyan-400 via-blue-500 to-indigo-600":"from-amber-300 via-yellow-400 to-orange-500";return React.createElement("div",{className:"space-y-1"},React.createElement("div",{className:"flex justify-between text-xs uppercase tracking-wide text-white/60"},React.createElement("span",null,label),React.createElement("span",{className:"font-mono text-white"},value,"/",max)),React.createElement("div",{className:"h-3 rounded bg-white/10 overflow-hidden"},React.createElement("div",{className:(0,utils.cn)("h-full bg-gradient-to-r transition-all duration-500",gradient),style:{width:`${pct}%`}})))}var gin7Mocks=__webpack_require__("./src/stories/mocks/gin7Mocks.tsx");const Gin7CommandPanel_stories={title:"Gin7/CommandPanel",component:function Gin7CommandPanel(){const session=(0,gin7Store.g)(state=>state.session),commandCatalog=(0,gin7Store.g)(state=>state.commandCatalog),sessionSnapshot=(0,gin7Store.g)(state=>state.sessionSnapshot),hoveredCell=(0,gin7Store.g)(state=>state.hoveredCell),{execute,isExecuting}=function useCommandExecution(){const[isExecuting,setIsExecuting]=(0,react.useState)(!1),{userProfile,updateCP}=(0,gameStore.T)(),sessionId=(0,gin7Store.g)(state=>state.sessionId);return{execute:(0,react.useCallback)(async({cardId,command,args})=>{if(userProfile){setIsExecuting(!0);try{const result=await gin7.m.executeCommand({sessionId,cardId,commandCode:command.code,characterId:userProfile.characterId||userProfile.id,args});result.cpSpent&&updateCP(-(result.cpSpent.pcp??0),-(result.cpSpent.mcp??0)),result.success||console.warn("[gin7] Command execution warning",result.message)}catch(error){console.error("[gin7] Command execution failed",error)}finally{setIsExecuting(!1)}}},[sessionId,updateCP,userProfile]),isExecuting}}(),profile=(0,gameStore.T)(state=>state.userProfile),[selectedGroup,setSelectedGroup]=(0,react.useState)("all"),[searchTerm,setSearchTerm]=(0,react.useState)(""),[page,setPage]=(0,react.useState)(0),cardTemplates=(0,react.useMemo)(()=>commandCatalog?new Map(commandCatalog.authorityCards.map(template=>[template.templateId,template])):new Map,[commandCatalog]),groupFilters=(0,react.useMemo)(()=>{if(!commandCatalog)return["all"];const groups=new Set(["all"]);return commandCatalog.authorityCards.forEach(template=>{(template.commandGroups||[]).forEach(group=>groups.add(group))}),Array.from(groups)},[commandCatalog]),filteredCards=(0,react.useMemo)(()=>{if(!session)return[];const term=searchTerm.trim().toLowerCase();return session.cards.filter(card=>{const template=cardTemplates.get(card.templateId),matchesGroup="all"===selectedGroup||Boolean(template?.commandGroups?.includes(selectedGroup)||card.commandMeta.some(meta=>meta.group===selectedGroup));return!!matchesGroup&&(!term||(card.title.toLowerCase().includes(term)||card.commandMeta.some(meta=>meta.label.toLowerCase().includes(term)||meta.code.toLowerCase().includes(term))))})},[session,cardTemplates,selectedGroup,searchTerm]),pageCount=Math.max(1,Math.ceil(filteredCards.length/3)),currentPage=Math.min(page,pageCount-1),cardsToDisplay=filteredCards.slice(3*currentPage,3*currentPage+3);(0,react.useEffect)(()=>{setPage(0)},[selectedGroup,searchTerm,session?.cards.length]);const regenLabel=(0,react.useMemo)(()=>{if(!session)return"—";return`${Math.floor(session.cpRegenSeconds/60)}분 ${(session.cpRegenSeconds%60).toString().padStart(2,"0")}초`},[session]),loopStats=sessionSnapshot?.clock.loopStats,cardSummary=sessionSnapshot?.cards,commandStats=sessionSnapshot?.commandPoints,shortcutWatchlist=sessionSnapshot?.shortcuts??[],recentAssignments=cardSummary?.recentAssignments??[];return session&&profile?React.createElement("section",{"data-testid":"gin7-command-panel",className:"rounded-3xl border border-white/10 bg-gradient-to-b from-[#0f1324] to-[#090b18] p-5 shadow-[0_0_40px_rgba(0,0,0,0.35)] space-y-5"},React.createElement("header",{className:"space-y-3"},React.createElement("div",null,React.createElement("p",{className:"text-xs uppercase tracking-[0.3em] text-primary/60"},"세션 · GIN7"),React.createElement("div",{className:"flex items-center justify-between gap-4"},React.createElement("div",null,React.createElement("h2",{className:"text-2xl font-black text-white"},profile.name),React.createElement("p",{className:"text-sm text-white/60"},profile.rank," · ","empire"===profile.faction?"은하제국군":"자유행성동맹군")),React.createElement("div",{className:"text-right"},React.createElement("p",{className:"text-xs text-white/50"},"CP 회복"),React.createElement("p",{className:"font-mono text-lg text-emerald-300"},regenLabel)))),React.createElement("div",{className:"grid gap-3 text-xs text-white/60 sm:grid-cols-2"},React.createElement("div",{className:"rounded-2xl border border-white/10 bg-black/20 p-3"},React.createElement("p",{className:"text-[11px] uppercase tracking-wide text-white/40"},"루프 평균"),React.createElement("p",{className:"mt-1 text-lg font-semibold text-cyan-300"},loopStats?`${loopStats.avgTickDurationMs}ms`:"—"),React.createElement("p",null,"최대 ",loopStats?.maxTickDurationMs??"—","ms · 샘플 ",loopStats?.sampleCount??"—")),React.createElement("div",{className:"rounded-2xl border border-white/10 bg-black/20 p-3"},React.createElement("p",{className:"text-[11px] uppercase tracking-wide text-white/40"},"최근 알림"),React.createElement("p",{className:"mt-1 text-lg font-semibold text-white"},loopStats?.lastAlertAt?new Date(loopStats.lastAlertAt).toLocaleString():"감지 없음"),React.createElement("p",null,loopStats?.lastAlertReason||"웹훅 정상 대기")))),React.createElement("div",{className:"space-y-3"},React.createElement(CPBar,{label:"PCP",value:profile.pcp,max:profile.maxPcp,tone:"gold"}),React.createElement(CPBar,{label:"MCP",value:profile.mcp,max:profile.maxMcp,tone:"blue"})),commandCatalog&&React.createElement("div",{className:"rounded-2xl border border-white/10 bg-black/20 p-4 text-white/70 space-y-3"},React.createElement("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between"},React.createElement("div",null,React.createElement("p",{className:"text-[11px] uppercase tracking-wide text-white/40"},"카탈로그"),React.createElement("p",{className:"text-sm text-white"},"v",commandCatalog.version," · ",commandCatalog.authorityCards.length,"장 / ",Object.keys(commandCatalog.commands).length,"커맨드")),React.createElement("input",{value:searchTerm,onChange:event=>setSearchTerm(event.target.value),placeholder:"카드·커맨드 검색",className:"rounded-xl border border-white/10 bg-black/40 px-3 py-2 text-sm text-white placeholder:text-white/30 focus:border-primary/50 focus:outline-none"})),React.createElement("div",{className:"flex flex-wrap gap-2"},groupFilters.map(group=>React.createElement("button",{key:group,onClick:()=>setSelectedGroup(group),className:(0,utils.cn)("rounded-full px-3 py-1 text-xs transition border",selectedGroup===group?"border-primary/60 bg-primary/20 text-primary-100":"border-white/10 text-white/60 hover:border-primary/40 hover:text-white")},GROUP_LABELS[group]||group)))),cardSummary&&commandStats&&React.createElement("div",{className:"grid gap-3 text-xs text-white/70 md:grid-cols-2"},React.createElement("div",{className:"rounded-2xl border border-white/10 bg-black/20 p-3"},React.createElement("p",{className:"text-[11px] uppercase tracking-wide text-white/40"},"카드 재고"),React.createElement("p",{className:"mt-1 text-lg font-semibold text-white"},"총 ",cardSummary.total,"장"),React.createElement("div",{className:"mt-2 grid grid-cols-2 gap-2"},Object.entries(cardSummary.byStatus).map(([status,count])=>React.createElement("div",{key:status,className:"rounded-lg border border-white/10 bg-black/30 px-2 py-1 text-white"},React.createElement("span",{className:"text-[10px] text-white/40"},status.toUpperCase()),React.createElement("p",{className:"text-base font-semibold"},count)))),recentAssignments.length>0&&React.createElement("p",{className:"mt-2 text-[11px] text-white/50"},"최근 발령: ",recentAssignments[0].title)),React.createElement("div",{className:"rounded-2xl border border-white/10 bg-black/20 p-3"},React.createElement("p",{className:"text-[11px] uppercase tracking-wide text-white/40"},"지휘 포인트"),React.createElement("p",{className:"mt-1 text-lg font-semibold text-white"},"평균 PCP ",commandStats.average.pcp.toFixed(2)," · MCP ",commandStats.average.mcp.toFixed(2)),React.createElement("p",{className:"text-white/60"},"저장 인원 ",commandStats.rosterSize,"명 · 저용량 ",commandStats.lowCapacity,"명"),React.createElement("p",{className:"text-white/50"},"대체 사용 ",commandStats.substitutionDebt,"명"))),React.createElement("div",{className:"space-y-4"},0===cardsToDisplay.length?React.createElement("div",{className:"rounded-2xl border border-white/10 bg-black/20 p-4 text-sm text-white/60"},"적용된 필터와 일치하는 직무 권한 카드가 없습니다."):cardsToDisplay.map(card=>{const template=cardTemplates.get(card.templateId),term=searchTerm.trim().toLowerCase(),commandRows=card.commandMeta.filter(meta=>!("all"!==selectedGroup&&meta.group!==selectedGroup&&!template?.commandGroups?.includes(selectedGroup))&&(!term||(meta.label.toLowerCase().includes(term)||meta.code.toLowerCase().includes(term))));return React.createElement("div",{key:card.id,className:"rounded-2xl border border-white/5 bg-white/5 backdrop-blur-sm p-4 space-y-4"},React.createElement("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},React.createElement("div",null,React.createElement("p",{className:"text-xs text-white/50"},card.rank),React.createElement("h3",{className:"text-lg font-semibold text-white"},card.title),React.createElement("p",{className:"text-[11px] text-white/50"},"요구 계급: ",template?.minRank??"제한 없음"," · 소속:"," ",template?.metadata?.organizationName??"공용")),React.createElement("div",{className:"text-right text-xs text-white/50"},React.createElement("p",null,"단축키"),React.createElement("p",{className:"font-mono text-base text-cyan-300"},card.shortcuts.map(s=>s.key.toUpperCase()).join(" · ")||"—"))),React.createElement("div",{className:"space-y-2 text-xs text-white/60"},0===commandRows.length?React.createElement("p",null,"필터와 일치하는 명령이 없습니다."):commandRows.map(meta=>{const shortcuts=card.shortcuts.filter(shortcut=>shortcut.commandCode===meta.code);return React.createElement("div",{key:meta.code,className:"grid gap-3 rounded-xl border border-white/10 bg-black/30 p-3 text-white/80 md:grid-cols-[1.5fr,0.8fr,0.6fr,1fr,auto]"},React.createElement("div",null,React.createElement("p",{className:"text-sm font-semibold text-white"},meta.label),React.createElement("p",{className:"text-[11px] text-white/40"},meta.code)),React.createElement("div",{className:"text-xs text-white/50"},GROUP_LABELS[meta.group]||meta.group),React.createElement("div",{className:"text-xs font-mono text-amber-200"},meta.cpType?`${meta.cpType} · ${meta.cpCost??"—"}`:"—"),React.createElement("div",{className:"space-y-1"},0===shortcuts.length&&React.createElement("span",{className:"text-white/40"},"—"),shortcuts.map(shortcut=>React.createElement("span",{key:`${meta.code}-${shortcut.key}`,className:"inline-flex items-center gap-2 rounded-full border border-white/10 px-2 py-1 text-[11px] text-white/70"},React.createElement("span",{className:"inline-flex h-5 w-5 items-center justify-center rounded border border-white/20 font-mono text-[10px] text-white"},shortcut.key.toUpperCase()),shortcut.label))),React.createElement("button",{onClick:()=>((card,command)=>{const target=hoveredCell?{gridX:hoveredCell.x,gridY:hoveredCell.y}:void 0;execute({cardId:card.id,templateId:card.templateId,command,args:target})})(card,meta),disabled:isExecuting,className:"rounded-xl border border-primary/40 bg-primary/20 px-3 py-2 text-sm font-semibold text-primary-100 transition hover:border-primary/80 hover:bg-primary/30 disabled:opacity-50"},"실행"))})))})),pageCount>1&&React.createElement("div",{className:"flex items-center justify-between rounded-2xl border border-white/10 bg-black/20 px-4 py-2 text-xs text-white/70"},React.createElement("button",{onClick:()=>setPage(prev=>Math.max(0,prev-1)),disabled:0===currentPage,className:"rounded-full border border-white/10 px-3 py-1 disabled:opacity-40"},"이전"),React.createElement("p",null,"페이지 ",currentPage+1," / ",pageCount),React.createElement("button",{onClick:()=>setPage(prev=>Math.min(pageCount-1,prev+1)),disabled:currentPage>=pageCount-1,className:"rounded-full border border-white/10 px-3 py-1 disabled:opacity-40"},"다음")),shortcutWatchlist.length>0&&React.createElement("div",{className:"rounded-2xl border border-white/10 bg-black/30 p-4 text-xs text-white/70"},React.createElement("p",{className:"text-[11px] uppercase tracking-wide text-white/40"},"단축키 감시 목록"),React.createElement("div",{className:"mt-2 space-y-2"},shortcutWatchlist.slice(0,4).map(shortcut=>React.createElement("div",{key:shortcut.cardId,className:"flex items-center justify-between rounded-xl border border-white/10 bg-black/20 px-3 py-2"},React.createElement("div",null,React.createElement("p",{className:"text-white text-sm font-semibold"},shortcut.title),React.createElement("p",{className:"text-[11px] text-white/40"},shortcut.commandGroups?.join(" · "))),React.createElement("div",{className:"text-right text-white"},React.createElement("p",{className:"font-mono text-base text-cyan-300"},shortcut.commandCodes.slice(0,2).join(", ")),React.createElement("p",{className:"text-[11px] text-white/40"},shortcut.status)))))),isExecuting&&React.createElement("div",{className:"rounded-2xl border border-cyan-500/40 bg-cyan-500/10 px-4 py-2 text-center text-xs font-mono text-cyan-200 animate-pulse"},"명령 채널 · 전송 중...")):React.createElement("div",{className:"rounded-2xl border border-white/10 bg-gradient-to-b from-slate-900 to-slate-950 p-4 text-sm text-white/70"},"GIN7 세션 정보를 불러오는 중...")},decorators:[Story=>React.createElement("div",{className:"min-h-screen bg-[#01030a] p-6"},React.createElement(gin7Mocks.k,null,React.createElement(Story,null)))]},Default={},__namedExportsOrder=["Default"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"{}",...Default.parameters?.docs?.source}}}},"./src/lib/utils.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{cn:()=>cn});var clsx__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/clsx/dist/clsx.mjs"),tailwind_merge__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/tailwind-merge/dist/bundle-mjs.mjs");function cn(...inputs){return(0,tailwind_merge__WEBPACK_IMPORTED_MODULE_1__.QP)((0,clsx__WEBPACK_IMPORTED_MODULE_0__.$)(inputs))}}}]);
"use strict";(self.webpackChunkopen_sam_front=self.webpackChunkopen_sam_front||[]).push([[147],{"./src/components/gin7/Gin7TacticalHUD.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>Gin7TacticalHUD_stories});var react=__webpack_require__("./node_modules/react/index.js"),lib=__webpack_require__("./node_modules/pixi.js/lib/index.mjs");class PixiTacticalMapEngine{constructor(options){const{canvas,width,height,logicalWidth,logicalHeight}=options;this.width=width,this.height=height,this.logicalWidth=logicalWidth,this.logicalHeight=logicalHeight,console.log("[PixiTacticalMapEngine] init",{width,height,logicalWidth,logicalHeight}),this.app=new lib.lgM({view:canvas,width,height,background:2042167,antialias:!0});const root=this.app.stage,gridLayer=new lib.mcf;this.unitsLayer=new lib.mcf,root.addChild(gridLayer),root.addChild(this.unitsLayer),this.units=new Map,this.drawGrid(gridLayer)}destroy(){const appAny=this.app;appAny&&!appAny._destroyed&&appAny.renderer&&(appAny.destroy(!0,{children:!0,texture:!0,baseTexture:!0}),this.units.clear())}screenToGrid(x,y){const cellW=this.width/this.logicalWidth,cellH=this.height/this.logicalHeight,col=clamp(Math.floor(x/cellW),0,this.logicalWidth-1);return{row:clamp(Math.floor(y/cellH),0,this.logicalHeight-1),col}}upsertUnit(instance){console.log("[PixiTacticalMapEngine] upsertUnit",instance.id,instance.gridPos);const existing=this.units.get(instance.id);if(existing)return existing.instance=instance,void this.updateUnitSprite(existing.sprite,instance);const sprite=this.createUnitSprite(instance.visual);this.updateUnitSprite(sprite,instance),this.unitsLayer.addChild(sprite),this.units.set(instance.id,{instance,sprite})}removeUnit(id){const entry=this.units.get(id);entry&&(this.unitsLayer.removeChild(entry.sprite),entry.sprite.destroy(),this.units.delete(id))}drawGrid(layer){const g=new lib.A1g;layer.addChild(g),g.clear(),g.beginFill(2042167),g.drawRect(0,0,this.width,this.height),g.endFill();const cellW=this.width/this.logicalWidth,cellH=this.height/this.logicalHeight;g.lineStyle(1,16777215,.9);for(let c=0;c<=this.logicalWidth;c+=1){const x=c*cellW;g.moveTo(x,0),g.lineTo(x,this.height)}for(let r=0;r<=this.logicalHeight;r+=1){const y=r*cellH;g.moveTo(0,y),g.lineTo(this.width,y)}}createUnitSprite(visual){const container=new lib.mcf,g=new lib.A1g;container.addChild(g);const color=function getUnitColor(visual){const isElite=!!visual.isElite,role=visual.role,tags=visual.cultureTags||[];if(tags.includes("Han"))return"cavalry"===role?isElite?4906624:2278750:"archer"===role?isElite?6333946:3900150:"spear"===role||"polearm"===role?isElite?16436245:15381256:16347926;return"cavalry"===role?isElite?16347926:15357964:"archer"===role?isElite?6514417:5195493:"spear"===role||"polearm"===role?isElite?16347926:16498468:isElite?15680580:14427686}(visual);return g.beginFill(color),g.drawRoundedRect(-10,-10,20,20,4),g.endFill(),g.lineStyle(1,0,.8),g.drawRoundedRect(-10,-10,20,20,4),container}updateUnitSprite(sprite,instance){const cellW=this.width/this.logicalWidth,cellH=this.height/this.logicalHeight,{row,col}=instance.gridPos,x=(col+.5)*cellW,y=(row+.5)*cellH;sprite.position.set(x,y)}}function clamp(value,min,max){return Math.max(min,Math.min(max,value))}var gin7Store=__webpack_require__("./src/stores/gin7Store.ts"),useGin7Telemetry=__webpack_require__("./src/hooks/useGin7Telemetry.ts");function Gin7TacticalPrototype(){const canvasRef=(0,react.useRef)(null),engineRef=(0,react.useRef)(null),previousIds=(0,react.useRef)([]),units=(0,gin7Store.g)(state=>state.tactical?.units??[]),recordLocalTelemetry=(0,gin7Store.g)(state=>state.recordLocalTelemetry);return(0,useGin7Telemetry.o)({scene:"tactical",enabled:units.length>0,sampleIntervalMs:5e3,onSample:sample=>recordLocalTelemetry("tactical",sample)}),(0,react.useEffect)(()=>{if(canvasRef.current)return engineRef.current=new PixiTacticalMapEngine({canvas:canvasRef.current,width:360,height:360,logicalWidth:24,logicalHeight:24}),()=>{engineRef.current?.destroy(),engineRef.current=null}},[]),(0,react.useEffect)(()=>{const engine=engineRef.current;if(!engine)return;const newIds=units.map(unit=>unit.id);previousIds.current.forEach(id=>{newIds.includes(id)||engine.removeUnit(id)}),units.forEach(unit=>{const instance={id:unit.id,gridPos:unit.position,visual:(unitType=unit.type,faction=unit.faction,{id:`${unitType}-${faction}`,role:"escort"===unitType?"infantry":"cavalry",cultureTags:"empire"===faction?["Han"]:["YellowTurban"],weaponStyle:"flagship"===unitType?"long_spear":"short_spear",armorStyle:"escort"===unitType?"lamellar":"heavy",headStyle:"flagship"===unitType?"helmet_crest":"helmet",hasShield:"flagship"!==unitType,hasBanner:"flagship"===unitType,isElite:"flagship"===unitType})};var unitType,faction;engine.upsertUnit(instance)}),previousIds.current=newIds},[units]),React.createElement("canvas",{ref:canvasRef,"data-testid":"gin7-tactical-canvas",className:"w-full rounded-2xl border border-white/5 bg-[#0b1020]"})}const energyFields=[{key:"beam",label:"빔",description:"레이저 출력"},{key:"gun",label:"포",description:"포격/건 무장"},{key:"shield",label:"방어막",description:"방어막 회복"},{key:"engine",label:"기관",description:"추력/선회"},{key:"warp",label:"워프",description:"철수 차지"},{key:"sensor",label:"센서",description:"수색 범위"}];var gin7Mocks=__webpack_require__("./src/stories/mocks/gin7Mocks.tsx");const Gin7TacticalHUD_stories={title:"Gin7/TacticalHUD",component:function Gin7TacticalHUD(){const tactical=(0,gin7Store.g)(state=>state.tactical),chat=(0,gin7Store.g)(state=>state.chat),telemetrySamples=(0,gin7Store.g)(state=>state.telemetrySamples),localTelemetry=(0,gin7Store.g)(state=>state.localTelemetry),tacticalLocalSample=localTelemetry?.tactical,updateEnergy=(0,gin7Store.g)(state=>state.updateEnergy);if(!tactical)return React.createElement("section",{className:"rounded-3xl border border-white/10 bg-[#05070f] p-4 text-white/60"},"전술 HUD를 초기화하는 중입니다...");const totalEnergy=Object.values(tactical.energy).reduce((acc,value)=>acc+value,0);return React.createElement("section",{className:"rounded-3xl border border-white/10 bg-gradient-to-b from-[#05060f] to-[#090f1d] p-4 space-y-4 text-white","data-testid":"gin7-tactical-hud"},React.createElement("header",{className:"flex items-center justify-between"},React.createElement("div",null,React.createElement("p",{className:"text-xs text-white/50"},"전술 HUD"),React.createElement("h2",{className:"text-lg font-semibold"},"전술 뷰 / RTS 프로토타입")),React.createElement("div",{className:"text-right text-xs text-white/50"},"레이더 열기",React.createElement("div",{className:"mt-1 h-2 w-32 rounded-full bg-white/10 overflow-hidden"},React.createElement("div",{className:"h-full bg-gradient-to-r from-rose-500 to-orange-500","data-testid":"gin7-radar-bar",style:{width:100*tactical.radarHeat+"%"}})))),React.createElement(Gin7TacticalPrototype,null),React.createElement("div",{className:"rounded-2xl border border-white/10 bg-black/30 p-3"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("p",{className:"text-xs text-white/50"},"에너지 패널"),React.createElement("span",{className:"text-[11px] text-white/40"},"총합 ",totalEnergy,"%")),React.createElement("div",{className:"mt-2 grid grid-cols-2 gap-3"},energyFields.map(field=>React.createElement("label",{key:field.key,className:"text-xs text-white/60 space-y-1"},React.createElement("div",{className:"flex items-center justify-between text-[11px]"},React.createElement("span",null,field.label),React.createElement("span",{className:"text-white/40"},field.description)),React.createElement("input",{type:"range",min:0,max:40,value:tactical.energy[field.key],onChange:event=>updateEnergy(field.key,Number(event.target.value)),className:"w-full accent-cyan-400"}),React.createElement("div",{className:"text-right font-mono text-white text-xs","data-testid":`gin7-energy-${field.key}`},tactical.energy[field.key],"%"))))),React.createElement("div",{className:"rounded-2xl border border-white/10 bg-black/30 p-3 space-y-3"},React.createElement("div",{className:"flex items-center justify-between text-xs text-white/50"},React.createElement("span",null,"채팅 (전술)"),React.createElement("div",{className:"space-x-2"},React.createElement("button",{className:"rounded-full border border-white/10 px-2 py-0.5 text-[10px] uppercase tracking-wide"},"전체"),React.createElement("button",{className:"rounded-full border border-white/10 px-2 py-0.5 text-[10px] uppercase tracking-wide"},"함대"),React.createElement("button",{className:"rounded-full border border-white/10 px-2 py-0.5 text-[10px] uppercase tracking-wide"},"동진영"))),React.createElement("div",{className:"space-y-2 max-h-48 overflow-y-auto text-xs"},chat.map(message=>React.createElement("div",{key:message.id,className:"rounded-xl border border-white/5 bg-black/40 p-2"},React.createElement("div",{className:"flex items-center justify-between text-[10px] text-white/40"},React.createElement("span",null,message.channel.toUpperCase()),React.createElement("span",null,new Date(message.timestamp).toLocaleTimeString())),React.createElement("div",{className:"mt-0.5 text-white"},React.createElement("span",{className:"text-cyan-300 mr-1"},message.author,":"),message.text))))),React.createElement("div",{className:"rounded-2xl border border-white/10 bg-black/30 p-3"},React.createElement("div",{className:"flex items-center justify-between text-xs text-white/50"},React.createElement("span",null,"텔레메트리 샘플"),React.createElement("span",null,"최근 ",telemetrySamples.length,"건")),React.createElement("div",{className:"mt-2 space-y-2 text-xs text-white/70"},[...tacticalLocalSample?[tacticalLocalSample]:[],...telemetrySamples].slice(0,5).map((sample,index)=>React.createElement("div",{key:`${sample.scene}-${sample.collectedAt}-${index}`,className:"rounded-lg border border-white/10 bg-black/20 px-3 py-2"},React.createElement("div",{className:"flex items-center justify-between text-white"},React.createElement("span",{className:"font-semibold"},sample.scene.toUpperCase()),React.createElement("span",{className:"text-[11px] text-white/50"},new Date(sample.collectedAt).toLocaleTimeString())),React.createElement("p",{className:"text-white/60"},sample.avgFps,"fps · ",sample.cpuPct,"% CPU · ",sample.memoryMb,"MB"))))))},decorators:[Story=>React.createElement("div",{className:"min-h-screen bg-[#01030a] p-6"},React.createElement(gin7Mocks.k,null,React.createElement(Story,null)))]},Default={},__namedExportsOrder=["Default"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"{}",...Default.parameters?.docs?.source}}}},"./src/hooks/useGin7Telemetry.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{o:()=>useGin7Telemetry});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_lib_api_gin7__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/lib/api/gin7.ts");function useGin7Telemetry(options){(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{if("undefined"==typeof window)return;if(!1===options.enabled)return;let rafId;const state={frames:0,workTime:0,last:performance.now(),start:performance.now()},tick=now=>{const delta=now-state.last;state.frames+=1,state.workTime+=delta,state.last=now,rafId=requestAnimationFrame(tick)};rafId=requestAnimationFrame(tick);const interval=window.setInterval(async()=>{const durationMs=performance.now()-state.start;if(durationMs<=0||0===state.frames)return;const avgFps=Number((state.frames/durationMs*1e3).toFixed(2)),cpuPct=Number(Math.min(100,state.workTime/durationMs*100).toFixed(2)),memory=performance.memory?.usedJSHeapSize??0,memoryMb=memory?Number((memory/1048576).toFixed(2)):0,payload={scene:options.scene,avgFps,cpuPct,memoryMb,sampleCount:state.frames,durationMs:Math.round(durationMs)},sample={...payload,collectedAt:(new Date).toISOString()};if(function recordInWindow(sample){if("undefined"==typeof window)return;window.__gin7Telemetry||(window.__gin7Telemetry={});window.__gin7Telemetry[sample.scene]=sample}(sample),options.onSample?.(sample),state.frames=0,state.workTime=0,state.start=performance.now(),state.last=state.start,!options.skipNetwork)try{await _lib_api_gin7__WEBPACK_IMPORTED_MODULE_1__.m.submitTelemetry(payload)}catch(error){console.warn("[gin7Telemetry] submit failed",error)}},options.sampleIntervalMs??1e4);return()=>{cancelAnimationFrame(rafId),window.clearInterval(interval)}},[options.scene,options.enabled,options.sampleIntervalMs,options.skipNetwork,options.onSample])}}}]);
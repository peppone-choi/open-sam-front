/*! For license information please see components-gin7-Gin7StrategicMap-stories.937e2f59.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkopen_sam_front=self.webpackChunkopen_sam_front||[]).push([[487],{"./node_modules/use-sync-external-store/cjs/use-sync-external-store-shim.production.js":(__unused_webpack_module,exports,__webpack_require__)=>{var React=__webpack_require__("./node_modules/react/index.js");var objectIs="function"==typeof Object.is?Object.is:function is(x,y){return x===y&&(0!==x||1/x==1/y)||x!=x&&y!=y},useState=React.useState,useEffect=React.useEffect,useLayoutEffect=React.useLayoutEffect,useDebugValue=React.useDebugValue;function checkIfSnapshotChanged(inst){var latestGetSnapshot=inst.getSnapshot;inst=inst.value;try{var nextValue=latestGetSnapshot();return!objectIs(inst,nextValue)}catch(error){return!0}}var shim="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function useSyncExternalStore$1(subscribe,getSnapshot){return getSnapshot()}:function useSyncExternalStore$2(subscribe,getSnapshot){var value=getSnapshot(),_useState=useState({inst:{value,getSnapshot}}),inst=_useState[0].inst,forceUpdate=_useState[1];return useLayoutEffect(function(){inst.value=value,inst.getSnapshot=getSnapshot,checkIfSnapshotChanged(inst)&&forceUpdate({inst})},[subscribe,value,getSnapshot]),useEffect(function(){return checkIfSnapshotChanged(inst)&&forceUpdate({inst}),subscribe(function(){checkIfSnapshotChanged(inst)&&forceUpdate({inst})})},[subscribe]),useDebugValue(value),value};exports.useSyncExternalStore=void 0!==React.useSyncExternalStore?React.useSyncExternalStore:shim},"./node_modules/use-sync-external-store/cjs/use-sync-external-store-shim/with-selector.production.js":(__unused_webpack_module,exports,__webpack_require__)=>{var React=__webpack_require__("./node_modules/react/index.js"),shim=__webpack_require__("./node_modules/use-sync-external-store/shim/index.js");var objectIs="function"==typeof Object.is?Object.is:function is(x,y){return x===y&&(0!==x||1/x==1/y)||x!=x&&y!=y},useSyncExternalStore=shim.useSyncExternalStore,useRef=React.useRef,useEffect=React.useEffect,useMemo=React.useMemo,useDebugValue=React.useDebugValue;exports.useSyncExternalStoreWithSelector=function(subscribe,getSnapshot,getServerSnapshot,selector,isEqual){var instRef=useRef(null);if(null===instRef.current){var inst={hasValue:!1,value:null};instRef.current=inst}else inst=instRef.current;instRef=useMemo(function(){function memoizedSelector(nextSnapshot){if(!hasMemo){if(hasMemo=!0,memoizedSnapshot=nextSnapshot,nextSnapshot=selector(nextSnapshot),void 0!==isEqual&&inst.hasValue){var currentSelection=inst.value;if(isEqual(currentSelection,nextSnapshot))return memoizedSelection=currentSelection}return memoizedSelection=nextSnapshot}if(currentSelection=memoizedSelection,objectIs(memoizedSnapshot,nextSnapshot))return currentSelection;var nextSelection=selector(nextSnapshot);return void 0!==isEqual&&isEqual(currentSelection,nextSelection)?(memoizedSnapshot=nextSnapshot,currentSelection):(memoizedSnapshot=nextSnapshot,memoizedSelection=nextSelection)}var memoizedSnapshot,memoizedSelection,hasMemo=!1,maybeGetServerSnapshot=void 0===getServerSnapshot?null:getServerSnapshot;return[function(){return memoizedSelector(getSnapshot())},null===maybeGetServerSnapshot?void 0:function(){return memoizedSelector(maybeGetServerSnapshot())}]},[getSnapshot,getServerSnapshot,selector,isEqual]);var value=useSyncExternalStore(subscribe,instRef[0],instRef[1]);return useEffect(function(){inst.hasValue=!0,inst.value=value},[value]),useDebugValue(value),value}},"./node_modules/use-sync-external-store/shim/index.js":(module,__unused_webpack_exports,__webpack_require__)=>{module.exports=__webpack_require__("./node_modules/use-sync-external-store/cjs/use-sync-external-store-shim.production.js")},"./node_modules/use-sync-external-store/shim/with-selector.js":(module,__unused_webpack_exports,__webpack_require__)=>{module.exports=__webpack_require__("./node_modules/use-sync-external-store/cjs/use-sync-external-store-shim/with-selector.production.js")},"./node_modules/zustand/esm/index.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{vt:()=>create});const createStoreImpl=createState=>{let state;const listeners=new Set,setState=(partial,replace)=>{const nextState="function"==typeof partial?partial(state):partial;if(!Object.is(nextState,state)){const previousState=state;state=(null!=replace?replace:"object"!=typeof nextState||null===nextState)?nextState:Object.assign({},state,nextState),listeners.forEach(listener=>listener(state,previousState))}},getState=()=>state,api={setState,getState,getInitialState:()=>initialState,subscribe:listener=>(listeners.add(listener),()=>listeners.delete(listener)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),listeners.clear()}},initialState=state=createState(setState,getState,api);return api},createStore=createState=>createState?createStoreImpl(createState):createStoreImpl;var react=__webpack_require__("./node_modules/react/index.js"),with_selector=__webpack_require__("./node_modules/use-sync-external-store/shim/with-selector.js");const{useDebugValue}=react,{useSyncExternalStoreWithSelector}=with_selector;let didWarnAboutEqualityFn=!1;const identity=arg=>arg;const createImpl=createState=>{"function"!=typeof createState&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const api="function"==typeof createState?createStore(createState):createState,useBoundStore=(selector,equalityFn)=>function useStore(api,selector=identity,equalityFn){equalityFn&&!didWarnAboutEqualityFn&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),didWarnAboutEqualityFn=!0);const slice=useSyncExternalStoreWithSelector(api.subscribe,api.getState,api.getServerState||api.getInitialState,selector,equalityFn);return useDebugValue(slice),slice}(api,selector,equalityFn);return Object.assign(useBoundStore,api),useBoundStore},create=createState=>createState?createImpl(createState):createImpl},"./src/components/gin7/Gin7StrategicMap.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>Gin7StrategicMap_stories});var react=__webpack_require__("./node_modules/react/index.js"),gin7Store=__webpack_require__("./src/stores/gin7Store.ts"),utils=__webpack_require__("./src/lib/utils.ts"),useGin7Telemetry=__webpack_require__("./src/hooks/useGin7Telemetry.ts");function factionColor(faction){switch(faction){case"empire":return"#fcd34d";case"alliance":return"#38bdf8";case"phezzan":return"#f472b6";default:return"#94a3b8"}}var gin7Mocks=__webpack_require__("./src/stories/mocks/gin7Mocks.tsx");const Gin7StrategicMap_stories={title:"Gin7/StrategicMap",component:function Gin7StrategicMap(){const canvasRef=(0,react.useRef)(null),miniMapRef=(0,react.useRef)(null),strategic=(0,gin7Store.g)(state=>state.strategic),strategySnapshot=(0,gin7Store.g)(state=>state.strategySnapshot),hoveredCell=(0,gin7Store.g)(state=>state.hoveredCell),setHoveredCell=(0,gin7Store.g)(state=>state.setHoveredCell),selectFleet=(0,gin7Store.g)(state=>state.selectFleet),selectedFleetId=(0,gin7Store.g)(state=>state.selectedFleetId),recordLocalTelemetry=(0,gin7Store.g)(state=>state.recordLocalTelemetry);(0,useGin7Telemetry.o)({scene:"strategy",enabled:Boolean(strategic),sampleIntervalMs:5e3,onSample:sample=>recordLocalTelemetry("strategy",sample)}),(0,react.useEffect)(()=>{if(!strategic||!canvasRef.current)return;const canvas=canvasRef.current;canvas.width=24*strategic.gridWidth,canvas.height=24*strategic.gridHeight;const ctx=canvas.getContext("2d");if(ctx){ctx.clearRect(0,0,canvas.width,canvas.height),ctx.fillStyle="#04060f",ctx.fillRect(0,0,canvas.width,canvas.height),strategic.cells.forEach(cell=>{const px=24*cell.x,py=24*cell.y;"impassable"===cell.type?ctx.fillStyle="#0f172a":"star_system"===cell.type?ctx.fillStyle="#1d2d54":ctx.fillStyle="#0b1120",ctx.fillRect(px,py,24,24),"star_system"===cell.type&&(ctx.fillStyle="#ffffff",ctx.font="10px var(--font-mono, monospace)",ctx.fillText(cell.label||"성계",px+2,py+12)),hoveredCell&&hoveredCell.x===cell.x&&hoveredCell.y===cell.y&&(ctx.strokeStyle="#0ea5e9",ctx.lineWidth=2,ctx.strokeRect(px+1,py+1,22,22))}),ctx.strokeStyle="rgba(255,255,255,0.03)",ctx.lineWidth=1;for(let x=0;x<=strategic.gridWidth;x+=1)ctx.beginPath(),ctx.moveTo(24*x,0),ctx.lineTo(24*x,canvas.height),ctx.stroke();for(let y=0;y<=strategic.gridHeight;y+=1)ctx.beginPath(),ctx.moveTo(0,24*y),ctx.lineTo(canvas.width,24*y),ctx.stroke();strategic.fleets.forEach(fleet=>{ctx.fillStyle=factionColor(fleet.faction);const cx=24*fleet.x+12,cy=24*fleet.y+12;ctx.beginPath(),ctx.arc(cx,cy,fleet.isFlagship?8:5,0,2*Math.PI),ctx.fill(),fleet.id===selectedFleetId&&(ctx.strokeStyle="#ffffff",ctx.lineWidth=2,ctx.beginPath(),ctx.arc(cx,cy,10,0,2*Math.PI),ctx.stroke())})}},[strategic,hoveredCell,selectedFleetId]),(0,react.useEffect)(()=>{if(!strategic||!miniMapRef.current)return;const canvas=miniMapRef.current;canvas.width=200,canvas.height=120;const ctx=canvas.getContext("2d");if(!ctx)return;ctx.clearRect(0,0,canvas.width,canvas.height),ctx.fillStyle="#020617",ctx.fillRect(0,0,canvas.width,canvas.height);const scaleX=canvas.width/strategic.gridWidth,scaleY=canvas.height/strategic.gridHeight;ctx.strokeStyle="#1e293b";for(let x=0;x<=strategic.gridWidth;x+=1)ctx.beginPath(),ctx.moveTo(x*scaleX,0),ctx.lineTo(x*scaleX,canvas.height),ctx.stroke();for(let y=0;y<=strategic.gridHeight;y+=1)ctx.beginPath(),ctx.moveTo(0,y*scaleY),ctx.lineTo(canvas.width,y*scaleY),ctx.stroke();strategic.fleets.forEach(fleet=>{ctx.fillStyle=factionColor(fleet.faction),ctx.fillRect(fleet.x*scaleX-2,fleet.y*scaleY-2,4,4)}),ctx.strokeStyle="#0ea5e9",ctx.strokeRect(strategic.viewport.x*scaleX,strategic.viewport.y*scaleY,8*scaleX,6*scaleY)},[strategic]);const mapMeta=strategySnapshot?.map.meta,operationHotspots=strategySnapshot?.operationHotspots??[],displayFleets=(0,react.useMemo)(()=>strategySnapshot?.fleets?strategySnapshot.fleets.map(fleet=>({id:fleet.fleetId,name:fleet.name,status:fleet.status,detail:`함선 ${fleet.totalShips} · 사기 ${fleet.morale}`})):(strategic?.fleets||[]).map(fleet=>({id:fleet.id,name:fleet.name,status:fleet.status,detail:`지휘 포인트 PCP ${fleet.cpLoad.pcp} / MCP ${fleet.cpLoad.mcp}`})),[strategySnapshot,strategic]),hoveredInfo=(0,react.useMemo)(()=>{if(!strategic||!hoveredCell)return"좌표를 호버해서 정보를 확인하세요";const cell=strategic.cells.find(c=>c.x===hoveredCell.x&&c.y===hoveredCell.y);if(!cell)return`${hoveredCell.x}, ${hoveredCell.y}`;return`${"star_system"===cell.type?"성계":"impassable"===cell.type?"진입 불가":"공간"} · (${cell.x}, ${cell.y}) ${cell.label||""}`.trim()},[strategic,hoveredCell]);return strategic?React.createElement("section",{className:"rounded-3xl border border-white/10 bg-gradient-to-b from-[#030711] to-[#050b18] p-4 space-y-4"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("div",null,React.createElement("p",{className:"text-xs text-white/50"},"메인 뷰"),React.createElement("h2",{className:"text-xl font-bold text-white"},"전략 그리드 투영")),React.createElement("div",{className:"text-xs text-white/40"},"그리드 ",strategic.gridWidth," × ",strategic.gridHeight)),mapMeta&&React.createElement("div",{className:"grid gap-3 text-xs text-white/60 sm:grid-cols-3"},React.createElement("div",{className:"rounded-2xl border border-white/10 bg-black/40 p-3"},React.createElement("p",{className:"text-[11px] uppercase tracking-wide text-white/40"},"성계 수"),React.createElement("p",{className:"mt-1 text-lg font-semibold text-white"},mapMeta.systemCount),React.createElement("p",null,"워프 경로 ",mapMeta.warpRouteCount)),React.createElement("div",{className:"rounded-2xl border border-white/10 bg-black/40 p-3"},React.createElement("p",{className:"text-[11px] uppercase tracking-wide text-white/40"},"루프 평균"),React.createElement("p",{className:"mt-1 text-lg font-semibold text-cyan-300"},strategySnapshot?.clock?.loopStats?.avgTickDurationMs??"—","ms"),React.createElement("p",null,"단계 ",strategySnapshot?.clock?.phase||"—")),React.createElement("div",{className:"rounded-2xl border border-white/10 bg-black/40 p-3"},React.createElement("p",{className:"text-[11px] uppercase tracking-wide text-white/40"},"작전 수"),React.createElement("p",{className:"mt-1 text-lg font-semibold text-white"},operationHotspots.length),React.createElement("p",null,"발령 대기 중"))),React.createElement("div",{className:"relative rounded-2xl border border-white/5 bg-black/40 overflow-hidden"},React.createElement("canvas",{ref:canvasRef,"data-testid":"gin7-strategic-canvas",className:"block w-full cursor-crosshair",onMouseMove:event=>{if(!canvasRef.current||!strategic)return;const rect=canvasRef.current.getBoundingClientRect(),rawX=(event.clientX-rect.left)/rect.width*strategic.gridWidth,rawY=(event.clientY-rect.top)/rect.height*strategic.gridHeight,x=Math.max(0,Math.min(strategic.gridWidth-1,Math.floor(rawX))),y=Math.max(0,Math.min(strategic.gridHeight-1,Math.floor(rawY)));setHoveredCell({x,y})},onMouseLeave:()=>setHoveredCell(null),onClick:event=>{if(!canvasRef.current||!strategic)return;const rect=canvasRef.current.getBoundingClientRect(),rawX=(event.clientX-rect.left)/rect.width*strategic.gridWidth,rawY=(event.clientY-rect.top)/rect.height*strategic.gridHeight,x=Math.max(0,Math.min(strategic.gridWidth-1,Math.floor(rawX))),y=Math.max(0,Math.min(strategic.gridHeight-1,Math.floor(rawY))),fleet=strategic.fleets.find(f=>f.x===x&&f.y===y);selectFleet(fleet?fleet.id:null)}}),React.createElement("div",{className:"absolute left-4 bottom-4 rounded-xl bg-black/70 px-3 py-2 text-xs font-mono text-white shadow-lg"},hoveredInfo)),React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4"},React.createElement("div",{className:"rounded-2xl border border-white/10 bg-black/30 p-3"},React.createElement("p",{className:"text-xs text-white/50 mb-2"},"은하 지도"),React.createElement("canvas",{ref:miniMapRef,className:"w-full rounded-lg border border-white/5 bg-black/50"})),React.createElement("div",{className:"rounded-2xl border border-white/10 bg-black/30 p-3 col-span-2"},React.createElement("p",{className:"text-xs text-white/50 mb-2"},"시스템 & 메신저"),React.createElement("div",{className:"grid grid-cols-2 gap-2 text-xs text-white/70"},displayFleets.map(fleet=>React.createElement("div",{key:fleet.id,className:(0,utils.cn)("rounded-lg border border-white/5 p-2",fleet.id===selectedFleetId&&"border-cyan-400/60 bg-cyan-400/5")},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("span",{className:"font-semibold text-white"},fleet.name),React.createElement("span",{className:"text-[10px] text-white/50"},fleet.status?.toString().toUpperCase())),React.createElement("div",{className:"mt-1 text-[11px] text-white/50"},fleet.detail)))))),operationHotspots.length>0&&React.createElement("div",{className:"rounded-2xl border border-white/10 bg-black/30 p-4 text-xs text-white/70"},React.createElement("p",{className:"text-[11px] uppercase tracking-wide text-white/40"},"예약된 작전"),React.createElement("div",{className:"mt-2 space-y-2"},operationHotspots.map(op=>React.createElement("div",{key:op.operationId,className:"rounded-xl border border-white/10 bg-black/20 px-3 py-2"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("span",{className:"text-white font-semibold"},op.code),React.createElement("span",{className:"text-[10px] text-white/40"},op.status.toUpperCase())),React.createElement("p",{className:"text-white/60"},op.objectiveType," · 그리드 (",op.targetGrid.x,", ",op.targetGrid.y,")"),React.createElement("p",{className:"text-white/40"},"발령 ",op.issuedAt?new Date(op.issuedAt).toLocaleString():"—"," · 대기 ",op.waitHours??0,"시간")))))):React.createElement("div",{className:"h-[520px] w-full rounded-3xl border border-white/5 bg-black/30"})},parameters:{layout:"fullscreen"},decorators:[Story=>React.createElement("div",{className:"min-h-screen bg-[#030711] p-6"},React.createElement(gin7Mocks.k,null,React.createElement(Story,null)))]},Default={},__namedExportsOrder=["Default"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"{}",...Default.parameters?.docs?.source}}}},"./src/hooks/useGin7Telemetry.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{o:()=>useGin7Telemetry});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_lib_api_gin7__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/lib/api/gin7.ts");function useGin7Telemetry(options){(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{if("undefined"==typeof window)return;if(!1===options.enabled)return;let rafId;const state={frames:0,workTime:0,last:performance.now(),start:performance.now()},tick=now=>{const delta=now-state.last;state.frames+=1,state.workTime+=delta,state.last=now,rafId=requestAnimationFrame(tick)};rafId=requestAnimationFrame(tick);const interval=window.setInterval(async()=>{const durationMs=performance.now()-state.start;if(durationMs<=0||0===state.frames)return;const avgFps=Number((state.frames/durationMs*1e3).toFixed(2)),cpuPct=Number(Math.min(100,state.workTime/durationMs*100).toFixed(2)),memory=performance.memory?.usedJSHeapSize??0,memoryMb=memory?Number((memory/1048576).toFixed(2)):0,payload={scene:options.scene,avgFps,cpuPct,memoryMb,sampleCount:state.frames,durationMs:Math.round(durationMs)},sample={...payload,collectedAt:(new Date).toISOString()};if(function recordInWindow(sample){if("undefined"==typeof window)return;window.__gin7Telemetry||(window.__gin7Telemetry={});window.__gin7Telemetry[sample.scene]=sample}(sample),options.onSample?.(sample),state.frames=0,state.workTime=0,state.start=performance.now(),state.last=state.start,!options.skipNetwork)try{await _lib_api_gin7__WEBPACK_IMPORTED_MODULE_1__.m.submitTelemetry(payload)}catch(error){console.warn("[gin7Telemetry] submit failed",error)}},options.sampleIntervalMs??1e4);return()=>{cancelAnimationFrame(rafId),window.clearInterval(interval)}},[options.scene,options.enabled,options.sampleIntervalMs,options.skipNetwork,options.onSample])}},"./src/lib/utils.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{cn:()=>cn});var clsx__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/clsx/dist/clsx.mjs"),tailwind_merge__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/tailwind-merge/dist/bundle-mjs.mjs");function cn(...inputs){return(0,tailwind_merge__WEBPACK_IMPORTED_MODULE_1__.QP)((0,clsx__WEBPACK_IMPORTED_MODULE_0__.$)(inputs))}}}]);
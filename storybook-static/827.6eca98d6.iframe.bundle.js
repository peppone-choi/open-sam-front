"use strict";(self.webpackChunkopen_sam_front=self.webpackChunkopen_sam_front||[]).push([[827],{"./src/lib/api/logh.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{loghApi:()=>loghApi});const API_BASE="/api/logh",fetchWithAuth=async(url,options={})=>{const headers={"Content-Type":"application/json",Authorization:"Bearer DEV-GALAXY-TOKEN",...options.headers},res=await fetch(url,{...options,headers});if(!res.ok){const error=await res.text().catch(()=>res.statusText);throw new Error(`API Error ${res.status}: ${error}`)}return res.json()},CMD_MAP={warp:"move_fleet",move:"move_fleet",attack:"issue_operation",supply:"issue_operation",personnel:"issue_operation",tactics:"issue_operation"},loghApi={getGalaxyViewport:async sessionId=>{const params=new URLSearchParams;sessionId&&params.set("sessionId",sessionId);const response=await fetch(`/api/gin7/state/strategy?${params.toString()}`);if(!response.ok)throw new Error("Failed to fetch galaxy viewport data");return response.json()},getGroundCombatState:async(battleId,sessionId)=>{const params=new URLSearchParams;sessionId&&params.set("sessionId",sessionId);const response=await fetch(`/api/logh/ground-combat/${battleId}?${params.toString()}`);if(!response.ok)throw new Error("Failed to fetch ground combat state");return response.json()},getOccupationStatus:async(battleId,sessionId)=>{const params=new URLSearchParams;sessionId&&params.set("sessionId",sessionId);const response=await fetch(`/api/logh/ground-combat/${battleId}/occupation?${params.toString()}`);if(!response.ok)throw new Error("Failed to fetch occupation status");return response.json()},getSupplyBatches:async(battleId,sessionId)=>{const params=new URLSearchParams;sessionId&&params.set("sessionId",sessionId);const response=await fetch(`/api/logh/ground-combat/${battleId}/supplies?${params.toString()}`);if(!response.ok)throw new Error("Failed to fetch supply batches");return response.json()},getWarehouseStocks:async(battleId,sessionId)=>{const params=new URLSearchParams;sessionId&&params.set("sessionId",sessionId);const response=await fetch(`/api/logh/ground-combat/${battleId}/warehouse?${params.toString()}`);if(!response.ok)throw new Error("Failed to fetch warehouse stocks");return response.json()},updateOccupation:async(battleId,planetId,updates,sessionId)=>{const response=await fetch(`/api/logh/ground-combat/${battleId}/occupation/${planetId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({...updates,sessionId})});if(!response.ok)throw new Error("Failed to update occupation status");return response.json()},consumeSupply:async(battleId,batchId,amount,sessionId)=>{const response=await fetch(`/api/logh/ground-combat/${battleId}/supplies/${batchId}/consume`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount,sessionId})});if(!response.ok)throw new Error("Failed to consume supply");return response.json()},getUserProfile:async()=>{const data=await fetchWithAuth(`${API_BASE}/galaxy/commanders?my_character=true`);if(data.data&&data.data.length>0){const cmd=data.data[0];return{id:cmd.no.toString(),name:cmd.name,rank:cmd.rank,faction:cmd.faction,pcp:cmd.commandPoints?.personal||0,mcp:cmd.commandPoints?.military||0,maxPcp:100,maxMcp:100,jobCards:[]}}throw new Error("No commander found")},executeCommand:async(cardId,command,target)=>{const backendCmd=CMD_MAP[command],data=await fetchWithAuth(`${API_BASE}/command/execute`,{method:"POST",body:JSON.stringify({command:backendCmd,params:{target,cardId}})});return{success:data.success,message:data.message||"Command executed",pcpCost:0,mcpCost:0}},getEconomyState:async(sessionId,characterId)=>{const params=new URLSearchParams({sessionId});characterId&&params.set("characterId",characterId);return(await fetchWithAuth(`${API_BASE}/galaxy/economy/state?${params}`)).data},getEconomyEvents:async(sessionId,characterId,limit=10)=>{const params=new URLSearchParams({sessionId,limit:limit.toString()});characterId&&params.set("characterId",characterId);return(await fetchWithAuth(`${API_BASE}/galaxy/economy/events?${params}`)).data},getChatMessages:async(sessionId,channelType,scopeId,limit=50)=>{const params=new URLSearchParams({sessionId,channelType,limit:limit.toString()});scopeId&&params.append("scopeId",scopeId);return(await fetchWithAuth(`${API_BASE}/galaxy/comm/messages?${params}`)).data||[]},sendChatMessage:async(sessionId,channelType,senderCharacterId,message,scopeId,metadata)=>(await fetchWithAuth(`${API_BASE}/galaxy/comm/messages`,{method:"POST",body:JSON.stringify({sessionId,channelType,scopeId,senderCharacterId,message,metadata})})).data,getHandshakes:async(sessionId,characterId)=>{const params=new URLSearchParams({sessionId,characterId});return(await fetchWithAuth(`${API_BASE}/galaxy/comm/handshakes?${params}`)).data||[]},requestHandshake:async(sessionId,requesterCharacterId,targetCharacterId)=>(await fetchWithAuth(`${API_BASE}/galaxy/comm/handshakes`,{method:"POST",body:JSON.stringify({sessionId,requesterCharacterId,targetCharacterId})})).data,respondHandshake:async(sessionId,handshakeId,responderCharacterId,action)=>(await fetchWithAuth(`${API_BASE}/galaxy/comm/handshakes/${handshakeId}/respond`,{method:"POST",body:JSON.stringify({sessionId,responderCharacterId,action})})).data,getAddressBook:async(sessionId,characterId)=>{const params=new URLSearchParams({sessionId,characterId});return(await fetchWithAuth(`${API_BASE}/galaxy/comm/address-book?${params}`)).data||[]},addAddressBookEntry:async(sessionId,ownerCharacterId,contactCharacterId,contactName)=>(await fetchWithAuth(`${API_BASE}/galaxy/comm/address-book`,{method:"POST",body:JSON.stringify({sessionId,ownerCharacterId,contactCharacterId,contactName})})).data,autoResolveBattle:async(battleId,resolverCharacterId)=>fetchWithAuth(`${API_BASE}/galaxy/tactical-battles/${battleId}/resolve`,{method:"POST",body:JSON.stringify({autoResolve:!0,resolverCharacterId})}),checkOfflineCommanders:async(battleId,sessionId)=>{const params=new URLSearchParams;sessionId&&params.set("sessionId",sessionId);return(await fetchWithAuth(`${API_BASE}/galaxy/tactical-battles/${battleId}/offline-check?${params}`)).data||{hasOfflineCommanders:!1,offlineCommanderIds:[]}},getMyFleet:async()=>{try{const res=await fetchWithAuth(`${API_BASE}/fleet/my`);if(res.data)return res.data}catch(e){}return{id:"mock-fleet-1",commanderName:"Yang Wen-li",faction:"alliance",gridX:10,gridY:10,size:5e3,status:"idle",formation:"standard",morale:95,supplies:8e3,ammo:7500,ships:Array.from({length:20}).map((_,i)=>({id:`ship-${i}`,name:`Hyperion-${i}`,type:0===i?"battleship":i<5?"cruiser":"destroyer",durability:100,maxDurability:100,crew:100,maxCrew:100,energy:100,maxEnergy:100,status:"active"}))}},updateFormation:async formationId=>{try{return await fetchWithAuth(`${API_BASE}/fleet/formation`,{method:"POST",body:JSON.stringify({formation:formationId})}),!0}catch(e){return console.warn("API failed, using mock success"),!0}},getBattleState:async battleId=>{try{const res=await fetchWithAuth(`${API_BASE}/galaxy/tactical-battles/${battleId}`);if(res.data)return res.data}catch(e){}return{id:battleId,turn:1,phase:"planning",fleets:[{fleetId:"f1",name:"13th Fleet",faction:"alliance",totalShips:5e3,formation:"standard",tacticalPosition:{x:2e3,y:5e3,heading:0}},{fleetId:"f2",name:"Imperial Fleet",faction:"empire",totalShips:8e3,formation:"spindle",tacticalPosition:{x:8e3,y:5e3,heading:180}}]}}}}}]);